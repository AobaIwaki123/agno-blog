<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agno Blog - AI-Powered Blog Generation</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Agno Blog</h1>
            <p>AI-powered blog generation and management system</p>
        </div>

        <!-- Blog Generation Form -->
        <div class="form-container">
            <h2>ğŸ“ æ–°ã—ã„ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ç”Ÿæˆ</h2>
            <form id="generateForm">
                <div class="form-group">
                    <label for="url">URL:</label>
                    <input type="url" id="url" name="url" placeholder="https://example.com/article" required>
                </div>
                <div class="form-group">
                    <label for="template">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ:</label>
                    <select id="template" name="template">
                        <option value="general">ä¸€èˆ¬è¨˜äº‹</option>
                        <option value="technical">æŠ€è¡“è¨˜äº‹</option>
                        <option value="news">ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="instructions">ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤º (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
                    <textarea id="instructions" name="instructions" rows="3" placeholder="è¨˜äº‹ã®ãƒˆãƒ¼ãƒ³ã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã«ã¤ã„ã¦ã®æŒ‡ç¤º..."></textarea>
                </div>
                <button type="submit" class="btn">
                    <span id="generateText">ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ç”Ÿæˆ</span>
                    <span id="generateLoading" class="loading" style="display: none;"></span>
                </button>
            </form>
            
            <div id="result"></div>
        </div>

        <!-- Blog Posts Display -->
        <div class="form-container">
            <h2>ğŸ“š ç”Ÿæˆã•ã‚ŒãŸãƒ–ãƒ­ã‚°è¨˜äº‹</h2>
            <div id="blogPosts">
                <p class="text-center">è¨˜äº‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„</p>
            </div>
        </div>

        <!-- Template Management -->
        <div class="template-section">
            <h2>âš™ï¸ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†</h2>
            <div class="form-group">
                <label for="feedback">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ”¹å–„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:</label>
                <textarea id="feedback" name="feedback" rows="3" placeholder="ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ”¹å–„ç‚¹ã«ã¤ã„ã¦..."></textarea>
                <button onclick="updateTemplate()" class="btn btn-secondary">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°</button>
            </div>
            
            <div id="templateResult"></div>
        </div>
    </div>

    <script>
        // Generate blog post
        document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = document.getElementById('url').value;
            const template = document.getElementById('template').value;
            const instructions = document.getElementById('instructions').value;
            
            // Show loading state
            document.getElementById('generateText').style.display = 'none';
            document.getElementById('generateLoading').style.display = 'inline-block';
            document.getElementById('result').innerHTML = '';
            
            try {
                const response = await fetch('/api/generate-post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url, 
                        template_id: template,
                        custom_instructions: instructions 
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    document.getElementById('result').innerHTML = 
                        '<div class="alert alert-success">âœ… ãƒ–ãƒ­ã‚°è¨˜äº‹ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼</div>';
                    loadBlogPosts();
                } else {
                    document.getElementById('result').innerHTML = 
                        '<div class="alert alert-error">âŒ ã‚¨ãƒ©ãƒ¼: ' + result.message + '</div>';
                }
            } catch (error) {
                document.getElementById('result').innerHTML = 
                    '<div class="alert alert-error">âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message + '</div>';
            } finally {
                // Hide loading state
                document.getElementById('generateText').style.display = 'inline';
                document.getElementById('generateLoading').style.display = 'none';
            }
        });
        
        // Load blog posts
        async function loadBlogPosts() {
            try {
                const response = await fetch('/api/blog-posts');
                const posts = await response.json();
                
                const container = document.getElementById('blogPosts');
                
                if (posts.length === 0) {
                    container.innerHTML = '<p class="text-center">è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                    return;
                }
                
                container.innerHTML = posts.map(post => `
                    <div class="blog-post fade-in">
                        <h3>${post.title}</h3>
                        <div class="meta">
                            <strong>ä½œæˆæ—¥:</strong> ${new Date(post.created_at).toLocaleString('ja-JP')} | 
                            <strong>ã‚½ãƒ¼ã‚¹URL:</strong> <a href="${post.url_source}" target="_blank">${post.url_source}</a> |
                            <strong>ã‚¿ã‚°:</strong> ${post.tags.join(', ')}
                        </div>
                        <div class="content">${post.content}</div>
                        <div class="actions">
                            <button onclick="improvePost('${post.id}')" class="btn btn-small btn-success">è¨˜äº‹ã‚’æ”¹å–„</button>
                            <button onclick="deletePost('${post.id}')" class="btn btn-small btn-danger">å‰Šé™¤</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading blog posts:', error);
                document.getElementById('blogPosts').innerHTML = 
                    '<div class="alert alert-error">è¨˜äº‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }
        
        // Update template
        async function updateTemplate() {
            const feedback = document.getElementById('feedback').value;
            if (!feedback.trim()) {
                alert('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                const response = await fetch('/api/update-template', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        template_id: 'default', 
                        feedback: feedback 
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    document.getElementById('templateResult').innerHTML = 
                        '<div class="alert alert-success">âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸï¼</div>';
                    document.getElementById('feedback').value = '';
                } else {
                    document.getElementById('templateResult').innerHTML = 
                        '<div class="alert alert-error">âŒ ã‚¨ãƒ©ãƒ¼: ' + result.message + '</div>';
                }
            } catch (error) {
                document.getElementById('templateResult').innerHTML = 
                    '<div class="alert alert-error">âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message + '</div>';
            }
        }
        
        // Improve post
        async function improvePost(postId) {
            const feedback = prompt('æ”¹å–„ç‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (!feedback || !feedback.trim()) return;
            
            try {
                const response = await fetch(`/api/improve-post/${postId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ feedback: feedback.trim() })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    alert('âœ… è¨˜äº‹ãŒæ”¹å–„ã•ã‚Œã¾ã—ãŸï¼');
                    loadBlogPosts();
                } else {
                    alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.message);
                }
            } catch (error) {
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }
        
        // Delete post
        async function deletePost(postId) {
            if (!confirm('ã“ã®è¨˜äº‹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                // In a real implementation, this would call a delete API
                // For now, we'll just remove it from the display
                const posts = await fetch('/api/blog-posts').then(r => r.json());
                const updatedPosts = posts.filter(p => p.id !== postId);
                
                // Update the display
                const container = document.getElementById('blogPosts');
                if (updatedPosts.length === 0) {
                    container.innerHTML = '<p class="text-center">è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                } else {
                    // Reload the posts
                    loadBlogPosts();
                }
                
                alert('âœ… è¨˜äº‹ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸï¼');
            } catch (error) {
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }
        
        // Load blog posts on page load
        loadBlogPosts();
    </script>
</body>
</html>